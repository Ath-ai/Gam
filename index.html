<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Shooting Game</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #joystick { position: absolute; bottom: 50px; left: 50px; }
        .control-button { position: absolute; bottom: 50px; right: 50px; }
    </style>
</head>
<body>
    <div id="joystick"></div>
    <button class="control-button" id="shoot-button">Shoot</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.7.3/dist/nipplejs.min.js"></script>
    <script>
        // Import necessary Three.js classes
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';

        // Set up scene, camera, and renderer
        let scene, camera, renderer, clock, controls;
        let grass, gun, joystick, shootButton;
        let zombieSpawnInterval = 2000; // Spawn zombies every 2 seconds
        let zombies = [];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky color

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 5);

            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Add ground
            let groundGeometry = new THREE.PlaneGeometry(100, 100);
            let groundMaterial = new THREE.MeshBasicMaterial({ color: 0x228B22 });
            let ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // Load grass model
            let loader = new GLTFLoader();
            loader.load('realtime_grass.glb', function (gltf) {
                grass = gltf.scene;
                grass.position.set(0, 0, 0);
                scene.add(grass);
            });

            // Load gun model
            loader.load('tommy_gun.glb', function (gltf) {
                gun = gltf.scene;
                gun.position.set(0, -0.5, -1);
                camera.add(gun);
                scene.add(camera);
            });

            // Add joystick for movement
            let options = {
                zone: document.getElementById('joystick'),
                mode: 'static',
                position: { left: '50px', bottom: '50px' },
                color: 'blue',
                size: 100,
                threshold: 0.1,
            };
            joystick = nipplejs.create(options);
            joystick.on('move', function (evt, data) {
                if (data.direction) {
                    switch (data.direction.angle) {
                        case 'left':
                            camera.position.x -= 0.1;
                            break;
                        case 'right':
                            camera.position.x += 0.1;
                            break;
                        case 'up':
                            camera.position.z -= 0.1;
                            break;
                        case 'down':
                            camera.position.z += 0.1;
                            break;
                    }
                }
            });

            // Shoot button
            shootButton = document.getElementById('shoot-button');
            shootButton.addEventListener('click', shoot);

            // Spawn zombies
            setInterval(spawnZombie, zombieSpawnInterval);

            window.addEventListener('resize', onWindowResize, false);
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function shoot() {
            // Shooting logic here
            console.log('Shoot!');
        }

        function spawnZombie() {
            let zombieGeometry = new THREE.BoxGeometry(1, 2, 1);
            let zombieMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            let zombie = new THREE.Mesh(zombieGeometry, zombieMaterial);
            zombie.position.set(
                Math.random() * 10 - 5,
                1,
                Math.random() * 10 - 5
            );
            scene.add(zombie);
            zombies.push(zombie);
        }
    </script>
</body>
</html>
